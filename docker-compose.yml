version: '3.8'

services:
  claude-dev:
    platform: linux/arm64
    build:
      context: .
      dockerfile: Dockerfile
    image: claude-dev-ubuntu:latest
    container_name: claude-dev-env
    volumes:
      # Persistent workspace for repos and work
      - ./workspace:/workspace
      
      # Mount setup scripts directory
      - ./setup-container:/setup-container:ro
      
      # Mount configuration files, feel free to change this, it's just here to make you feel at home.
      - ./config/bashrc:/etc/bash.bashrc:ro
      - ./config/starship.toml:/root/.config/starship.toml:ro
      - ./config/.gitconfig:/etc/gitconfig:ro
      - ./config/gh-config.yml:/etc/gh/config.yml:ro
      
      # Mount Docker socket for container operations (optional)
      - /var/run/docker.sock:/var/run/docker.sock
      
      # Mount credentials from host
      - ~/.claude.json:/root/.claude-host.json:ro
      
    environment:
      # Load from .env file  
      - GITHUB_TOKEN=${GITHUB_TOKEN:-}
      - GH_TOKEN=${GITHUB_TOKEN:-}
      - CLAUDE_CREDENTIALS=${CLAUDE_CREDENTIALS:-}
      - GIT_USER_NAME=${GIT_USER_NAME:-}
      - GIT_USER_EMAIL=${GIT_USER_EMAIL:-}
      
      # Additional environment
      - NODE_ENV=development
      - FORCE_COLOR=true
      - IS_SANDBOX=1
      
    stdin_open: true
    tty: true
    
    # Initialize container
    command: |
      bash -c "
        /setup-container/setup-credentials.sh
        /setup-container/keep-alive.sh
      "
    
    # No restart so we can debug startup issues
    restart: "unless-stopped"

