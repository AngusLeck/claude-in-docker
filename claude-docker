#!/bin/bash
# claude-docker - Run Claude in a Docker container
# Routes to the appropriate script based on flags

set -e

# Get directory where this script lives, resolving symlinks.
# - BASH_SOURCE[0]: path used to invoke this script (may be a symlink)
# - dirname: extracts the directory portion
# - cd && pwd: resolves to absolute path, following symlinks
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

case "$1" in
    --uninstall)
        exec "$SCRIPT_DIR/claude-docker-uninstall"
        ;;
    --update)
        exec "$SCRIPT_DIR/claude-docker-update"
        ;;
    --workspace|-w)
        echo "$SCRIPT_DIR/workspace"
        exit 0
        ;;
    -g|--global)
        shift
        exec "$SCRIPT_DIR/claude-docker-global" "$@"
        ;;
    --help|-h)
        echo "Usage: claude-docker [OPTIONS] [CLAUDE_ARGS...]"
        echo
        echo "Run Claude in a Docker container."
        echo
        echo "Modes:"
        echo "  (default)      Project mode - mount current directory"
        echo "  -g, --global   Global mode - persistent workspace"
        echo
        echo "Options:"
        echo "  -s, --shell    Open bash shell instead of claude"
        echo "  -d, --dangerous Run claude with --dangerously-skip-permissions"
        echo
        echo "Management:"
        echo "  --update       Update to latest version"
        echo "  --uninstall    Remove claude-docker"
        echo "  -w, --workspace Print global workspace path"
        echo
        echo "  --help, -h     Show this help"
        echo
        echo "Examples:"
        echo "  claude-docker              Run claude in current directory"
        echo "  claude-docker -g           Run claude in global workspace"
        echo "  claude-docker -s           Open shell in project container"
        echo "  claude-docker -g -s        Open shell in global container"
        echo "  claude-docker -d           Run claude in dangerous mode"
        echo "  cd \$(claude-docker -w)     Navigate to global workspace"
        echo "  cursor \$(claude-docker -w) Open workspace in IDE"
        exit 0
        ;;
    *)
        exec "$SCRIPT_DIR/claude-docker-project" "$@"
        ;;
esac
