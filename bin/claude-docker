#!/bin/bash
# claude-docker - Run Claude in a Docker container
# Routes to the appropriate script based on flags

set -e

# Resolve symlinks to get the actual script location
SCRIPT_PATH="${BASH_SOURCE[0]}"
while [[ -L "$SCRIPT_PATH" ]]; do
    LINK_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
    SCRIPT_PATH="$(readlink "$SCRIPT_PATH")"
    [[ "$SCRIPT_PATH" != /* ]] && SCRIPT_PATH="$LINK_DIR/$SCRIPT_PATH"
done
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
ROOT_DIR="$(dirname "$SCRIPT_DIR")"

case "$1" in
    --uninstall)
        exec "$SCRIPT_DIR/claude-docker-uninstall"
        ;;
    --update)
        exec "$SCRIPT_DIR/claude-docker-update"
        ;;
    --workspace|-w)
        echo "$ROOT_DIR/workspace"
        exit 0
        ;;
    -g|--global)
        shift
        exec "$SCRIPT_DIR/claude-docker-global" "$@"
        ;;
    --help|-h)
        echo "Usage: claude-docker [OPTIONS] [CLAUDE_ARGS...]"
        echo
        echo "Run Claude in a Docker container."
        echo
        echo "Modes:"
        echo "  (default)      Project mode - mount current directory"
        echo "  -g, --global   Global mode - persistent workspace"
        echo
        echo "Options:"
        echo "  -s, --shell    Open bash shell instead of claude"
        echo "  -d, --dangerous Run claude with --dangerously-skip-permissions"
        echo
        echo "Management:"
        echo "  --update       Update to latest version"
        echo "  --uninstall    Remove claude-docker"
        echo "  -w, --workspace Print global workspace path"
        echo
        echo "  --help, -h     Show this help"
        echo
        echo "Examples:"
        echo "  claude-docker              Run claude in current directory"
        echo "  claude-docker -g           Run claude in global workspace"
        echo "  claude-docker -s           Open shell in project container"
        echo "  claude-docker -g -s        Open shell in global container"
        echo "  claude-docker -d           Run claude in dangerous mode"
        echo "  cd \$(claude-docker -w)     Navigate to global workspace"
        echo "  cursor \$(claude-docker -w) Open workspace in IDE"
        exit 0
        ;;
    *)
        exec "$SCRIPT_DIR/claude-docker-project" "$@"
        ;;
esac
