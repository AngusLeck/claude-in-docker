#!/bin/bash
# claude-docker-global - Run Claude in global/workspace mode
# Long-running container with persistent workspace

set -e

# Get directory where this script lives, resolving symlinks.
# - BASH_SOURCE[0]: path used to invoke this script (may be a symlink)
# - dirname: extracts the directory portion
# - cd && pwd: resolves to absolute path, following symlinks
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

source "$SCRIPT_DIR/lib/flags.sh"
source "$SCRIPT_DIR/lib/container.sh"

CONTAINER_NAME="claude-dev-env"

parse_mode_flags "$@"
set -- "${REMAINING_ARGS[@]}"

cd "$SCRIPT_DIR"

# Ensure container is running
if ! container_running; then
    echo "Starting global Claude container..."
    docker-compose -f docker-compose.base.yml -f docker-compose.global.yml up -d
    sleep 2
fi

run_in_container "$@"
