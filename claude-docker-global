#!/bin/bash
# claude-docker-global - Run Claude in global/workspace mode
# Long-running container with persistent workspace

set -e

# Get the directory where this script lives (resolves symlinks).
# This allows the script to find sibling files (docker-compose.yml, config, etc.)
# regardless of where it's called from or whether it's accessed via symlink.
get_script_dir() {
    cd "$(dirname "${BASH_SOURCE[0]}")" && pwd
}

SCRIPT_DIR="$(get_script_dir)"
CONTAINER_NAME="claude-dev-env"

cd "$SCRIPT_DIR"

# Ensure container is running
if ! docker ps --format '{{.Names}}' | grep -q "^${CONTAINER_NAME}$"; then
    echo "Starting global Claude container..."
    docker-compose up -d

    # Wait for container to be ready
    sleep 2
fi

# Execute claude in the container
exec docker exec -it "$CONTAINER_NAME" claude "$@"
